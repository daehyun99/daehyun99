name: Update Contributions

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (í•œêµ­ì‹œê°„ ê¸°ì¤€ UTC 0ì‹œ)
    - cron: '0 0 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  push:
    branches: [ main ]
    paths:
      # íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸, ìš”êµ¬ì‚¬í•­, ì›Œí¬í”Œë¡œìš° íŒŒì¼ì´ ë³€ê²½ë  ë•Œ ì‹¤í–‰
      - 'main.py'
      - 'scripts/**.py'
      - 'requirements.txt'
      - '.github/workflows/**'
  pull_request:
    branches: [ main ]

permissions:
  contents: write # ì €ì¥ì†Œì— ì½”ë“œ push ê¶Œí•œ ë¶€ì—¬

jobs:
  update-contributions:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 1. Python ì„¤ì¹˜
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # ì›í•˜ì‹œëŠ” íŒŒì´ì¬ ë²„ì „ ì‚¬ìš©

      # 2. Python ì˜ì¡´ì„± ì„¤ì¹˜ (PyGithub, python-dotenv ë“±)
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 3. 'main.py' ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: Run update contributions script
        run: python main.py
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
          MY_USERNAME: ${{ github.repository_owner }} 

      # 4. ë³€ê²½ëœ data íŒŒì¼ë“¤ì„ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit updated data files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/commit.txt data/stage_issue.txt data/stage_pr.txt
          git diff --staged --quiet || git commit -m "ğŸ¤– Auto-update: Open source contributions data"
          git push
